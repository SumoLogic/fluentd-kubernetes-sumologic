apiVersion: extensions/v1beta1
kind: DaemonSet
metadata:
  name: fluentd
  labels:
    app: fluentd
    version: v1
spec:
  template:
    metadata:
      labels:
        name: fluentd
    spec:
      volumes:
      - name: pos-files
        emptyDir: {}
      - name: host-logs
        hostPath:
          path: /var/log/
      - name: docker-logs
        hostPath:
          path: /var/lib/docker
      - name: gcloud
        secret:
          secretName: sumologic
      containers:
      - image: gcr.io/driverinc-sandbox/sumologic:0.0.1-7
        name: fluentd
        imagePullPolicy: Always
        volumeMounts:
        - name: host-logs
          mountPath: /mnt/log/
          readOnly: true
        - name: host-logs
          mountPath: /var/log/
          readOnly: true
        - name: docker-logs
          mountPath: /var/lib/docker/
          readOnly: true
        - name: pos-files
          mountPath: /mnt/pos/
        - name: gcloud
          mountPath: /etc/gcloud/
          readOnly: true
        env:
        - name: SOURCE_CATEGORY_PREFIX
          value: sandbox/
        - name: SOURCE_CATEGORY
          value: kubernetes
        - name: LOG_FORMAT
          value: json_merge
        - name: SOURCE_NAME
          value: '%{container}.%{namespace}'
        - name: COLLECTOR_URL
          valueFrom:
            secretKeyRef:
              name: sumologic
              key: collector-url
        - name: GOOGLE_APPLICATION_CREDENTIALS
          value: /etc/gcloud/google-application-credentials
        - name: GCP_PROJECT_ID
          value: driverinc-sandbox
        - name: PUBSUB_TOPIC
          value: fluentd-k8s
        